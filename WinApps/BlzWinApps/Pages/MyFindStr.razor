@page "/myfindStr"
@inject FindStrService findstrService;
@inject OpenFileService startCommandService;
@inject NavigationManager Nav
@inject UserPersistentDataService userPersistentDataService;
<div class="input-container">

    <div class="form-container">
        <h3>Enter Your Data</h3>

        <div class="form-row">
            <label>File Path:</label>
            <input type="text" @bind="filePath" />
            <div style="padding-top:5px; display:flex; gap:5px;">
                <button @onclick="()=>{ showFolderPicker = !showFolderPicker;}">Show/Hide Folder Picker</button>
                <button @onclick="()=>{ showHistory = !showHistory;  }">Show/Hide History</button>
                <button @onclick="AddFavorites">Add to favorites</button>
            </div>

        </div>

        <div class="form-row">
            <label>Text to search:</label>
            <input type="text" @bind="textToSearch" />
        </div>

        <div class="form-row">
            <label>File extension to search in:</label>
            <input type="text" @bind="fileExtension" />
        </div>

        <button class="submit-btn" @onclick="Submit">Search string in folder path</button>
        <button class="submit-btn" style="margin-top:10px; background-color:green;" @onclick="()=>{ findStrSingleResults = new(); findStrTableResults.Refresh();}">Clean results</button>
    </div>

    @if (showFolderPicker)
    {
        <PathPicker  OnSelect="PathSelected"></PathPicker>
    }

    <SelectableList Title="Favorites" Items="userPersistentData.PathFavorites.ToArray()" OnItemSelected="PathSelected"></SelectableList>

    @if (showHistory)
    {
        <SelectableList Title="Path history" Items="userPersistentData.PathHistory.OrderByDescending(x=>x).ToArray()" OnItemSelected="PathSelected"></SelectableList>
    }

</div>

@if (isFindStrRunning)
{
    <div>
        running....
    </div>
}
else
{
    <FindStrTableResults 
    findStrSingleResults="findStrSingleResults" 
    PathSelectedForOpening="OpenPath" 
    @ref="findStrTableResults"/>
}

@code {

    public string filePath { get; set; }
    public string textToSearch { get; set; }
    public string fileExtension { get; set; } = "*.*";
    List<FindStrSingleResult> findStrSingleResults = new List<FindStrSingleResult>();
    private bool showFolderPicker = false;
    private bool isFindStrRunning = false;
    private bool showHistory = false;
    private UserPersistentData userPersistentData = new();
    private FindStrTableResults findStrTableResults;

    private async Task Submit()    {
        isFindStrRunning = true;
        findStrSingleResults = await findstrService.RequestServiceAsync(filePath, textToSearch, fileExtension);
        isFindStrRunning = false;
        findStrTableResults.Refresh();
             
        userPersistentData.AddPathHistory(filePath);
        await userPersistentDataService.SaveAsync(userPersistentData);       
    }

    private void PathSelected(string pathSelected)
    {
        filePath = pathSelected;
    }

    private void OpenPath(FileSelectedArgs args)
    {
        startCommandService.RequestService(args);
    }

    private async Task AddFavorites()
    {
        userPersistentData.AddToFavorites(filePath);
        await userPersistentDataService.SaveAsync(userPersistentData);
    }

    protected  override async Task OnInitializedAsync()
    {
        var uri = Nav.ToAbsoluteUri(Nav.Uri);
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);
        filePath = query["path"];

        userPersistentData = await userPersistentDataService.LoadAsync();

    }
}

<style>

    .entry-container{
        display:grid;
        grid-template-columns: 1fr;
        gap:15px;
    }

    .form-container { 
        width: 700px; 
        padding: 20px; 
        /*margin: 30px auto; */
        background: #f8f9fa; 
        border-radius: 12px; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
        font-family: Segoe UI, sans-serif; 
    } 
    
    .form-container h3 { 
        margin-bottom: 20px; 
        text-align: center; 
        color: #333; 
    } 
    .form-row { 
        display: flex; 
        flex-direction: column; 
        margin-bottom: 15px; 
    } 
    .form-row label { 
        margin-bottom: 5px; 
        font-weight: 600; 
        color: #555; 
    } 
    .form-row input { 
        padding: 10px; 
        border: 1px solid #ccc; 
        border-radius: 6px; 
        font-size: 14px; 
        transition: border-color 0.2s ease; 
    } 
    .form-row input:focus { 
        border-color: #0078d4; 
        outline: none; 
    } 
    .submit-btn { 
        width: 100%; 
        padding: 12px; 
        background: #0078d4; 
        color: white; 
        border: none; 
        border-radius: 6px; 
        font-size: 15px; 
        cursor: pointer; 
        transition: background 0.2s ease; 
    } 
    .submit-btn:hover { 
        background: #005fa3; 
    }

    .nice-table {
        width: 100%;
        border-collapse: collapse;
        font-family: Segoe UI, sans-serif;
        background: #fff;
        border-radius: 8px;
        
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .nice-table th {
        background: #f2f4f7;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: #333;
        border-bottom: 1px solid #ddd;
    }

    .nice-table td {
        padding: 10px 12px;
        border-bottom: 1px solid #eee;
        vertical-align: top;
        color: #444;
    }
    /* Column behavior */

    

    .nice-table tbody tr:hover {
        background: #f9fafb;
    }

    .input-container{
        display:flex;
        flex-direction: row;
        justify-content: flex-start;
        background-color:chocolate;
        padding:10px;
        gap:10px;
        border-radius:15px;
    }

    .simple-table{
        all:unset;
    }

    .nice-table table td
    .nice-table table tr
    .nice-table table tbody {
        all: unset;
    }

    .file-extract{
        background-color: black;
        font-family: Consolas, "Lucida Console", monospace;
        font-size:24px;
        font-weight:bold;

    }

    .entry-container{
        display:flex;
        flex-direction:column;
        gap:10px;
    }

    .form-container ul {
        list-style: none;
        padding-left: 0;
    }

    .form-container li {
        padding: 4px;
        cursor: pointer;
    }

    .form-container li:hover {
        background-color: lightskyblue;
    }

    .select-btn {
        margin-top: 10px;
        padding: 6px 12px;
    }

    .selectable-list {
        padding: 35px;
    }

    .selectable-list ul {
    }

    .selectable-list li {
        padding: unset;
        list-style: decimal;
        padding-left: 30px;
    }



</style>